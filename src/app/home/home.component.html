<div class="m-5">
  <div class="card hstack gap-3 p-3">
    <h3>Budget Tracker</h3>
    <div class="vr"></div>
    <h4>Dashboard</h4>
    <div class="ms-auto btn-group">
      <div class="btn btn-secondary">
        {{ currentUser.name }}
      </div>
      <div class="ms-auto btn btn-danger" (click)="logout()">Logout</div>
    </div>
  </div>

  <div class="card my-5 p-3">
    <div class="d-flex justify-content-around text-center">
      <div>
        <h4>Total Income</h4>
        <h5>NRS {{ income }}</h5>
      </div>
      <div class="vr"></div>
      <div class="">
        <h4>Total Expense</h4>
        <h5>NRS {{ expense }}</h5>
      </div>
      <div class="vr"></div>
      <div>
        <h4>Balance</h4>
        <h5>NRS {{ balance }}</h5>
      </div>
    </div>
  </div>

  <div class="display-stats mt border rounded p-2" *ngIf="isStatsVisible">
    <div>
      <input
        class="form-control form-control text-center"
        type="text"
        placeholder="Search"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      />

      <div class="d-flex justify-content-around my-3">
        <div>
          <div
            class="btn border px-5 py-3"
            *ngIf="!showDatePicker"
            (click)="toggleDatePicker()"
          >
            Date Range
          </div>
          <div *ngIf="showDatePicker">
            <input
              id="date"
              type="date"
              class="form-control"
              name="date"
              required
            />
            <input
              id="date"
              type="date"
              class="form-control"
              name="date"
              required
            />
          </div>
        </div>

        <select class="btn border px-5 py-3">
          <option disabled selected hidden>Type</option>
          <option>Income</option>
          <option>Expense</option>
        </select>
        <select class="btn border px-5 py-3">
          <option disabled selected hidden>Reoccuring</option>
          @for (reoccuring of reoccurings ; track reoccuring){
          <option value="{{ reoccuring }}">{{ reoccuring }}</option>
          }
        </select>
        <select class="btn border px-5 py-3">
          <option disabled selected hidden>Category</option>
          @for (category of categories ; track category){
          <option value="{{ category }}">{{ category }}</option>
          }
        </select>
      </div>
    </div>

    <table
      class="table table-responsive table-bordered text-center table-striped-columns caption-top"
    >
      <caption>
        Your Entires
      </caption>
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Amount</th>
          <th>Type</th>
          <th>Date</th>
          <th>Reoccuring</th>
          <th>Category</th>
          <th *ngIf="!isFormVisible">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (data of paginatedData() ; track data ;let i = $index){
        <tr>
          <th>{{ i + 1 }}</th>
          <td>{{ data.name }}</td>
          <td>{{ data.amount }}</td>
          <td>{{ data.type }}</td>
          <td>{{ data.date }}</td>
          <td>{{ data.reoccuring }}</td>
          <td>{{ data.category }}</td>
          <td *ngIf="!isFormVisible" class="p-0">
            <div class="btn-group w-100">
              <div class="btn btn-warning rounded-0" (click)="onEdit(data)">
                Edit
              </div>
              <div class="btn btn-danger rounded-0" (click)="onDelete(data.id)">
                Delete
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
    <div class="text-center btn-group col-12 mb-3">
      <button
        class="btn border"
        (click)="currentPage = currentPage - 1"
        [disabled]="currentPage === 1"
      >
        Previous
      </button>
      <span class="border p-1 px-5">{{ currentPage }}</span>
      <button
        class="btn border"
        (click)="currentPage = currentPage + 1"
        [disabled]="currentPage * itemsPerPage >= totalItems"
      >
        Next
      </button>
    </div>

    <button
      type="submit"
      class="btn btn-success"
      *ngIf="!isFormVisible"
      (click)="toggleFormVisibility()"
    >
      Add
    </button>
  </div>

  <app-add-form *ngIf="isFormVisible" />
</div>
